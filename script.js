const exerciciosSemana = {
  segunda: [
    {
      nome: "Supino inclinado",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/supino_inclinado.gif",
    },
    {
      nome: "Cruxifixo",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/crucifixo.gif",
    },
    {
      nome: "Supino reto",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/supino_reto.gif",
    },
    {
      nome: "CrossOver",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/crossover.webp",
    },
    {
      nome: "Desenvolvimento",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/desenvolvimento-maquina.gif",
    },
    {
      nome: "Elevação frontal polia",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/elevacao-frontal.gif",
    },
    {
      nome: "Tripceps corda",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/tripceps-corda.gif",
    },
    {
      nome: "Mergulho maquina",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/mergulho-maquina.gif",
    },
    {
      nome: "Abdominal Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/crunch_basic.gif",
    },
    {
      nome: "Prancha abdominal",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/prancha.webp",
    },
    {
      nome: "Abdominal invertido",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal_infra_solo.gif",
    },
    {
      nome: "Prancha lateral",
      tipo: "abdomen",
      series: "3x side",
      gif: "gift/prancha-lateral.gif",
    },
    {
      nome: "Elevação pélvica",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/original.webp",
    },
    {
      nome: "Cat cow pose",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/cat-cow.gif",
    },
  ],
  terca: [
    {
      nome: "Puxada aberta",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/puxada-aberta.webp",
    },
    {
      nome: "Puxada Triângulo",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/puxada-triangulo.webp",
    },
    {
      nome: "Remada baixa",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/remada-baixa.gif",
    },
    {
      nome: "Crucifixo invertido",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/crucifixo-invertido.gif",
    },
    {
      nome: "Rosca alternada",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/rosca-alternada-sentado.gif",
    },
    {
      nome: "Rosca direta polia",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/rosca-direta-polia.gif",
    },
    {
      nome: "Rosca martelo",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/Rosca-martelo.webp",
    },
    {
      nome: "Remada curvada",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/Remada-curvada.webp",
    },
    {
      nome: "Elevação das pernas",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/elevacao-pernas.webp",
    },
    {
      nome: "Russian twist",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/russian-twist.webp",
    },
    {
      nome: "Abdominal bicicleta",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-bicicleta.gif",
    },
    {
      nome: "Prancha com toque no ombro",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/Prancha-toque-ombro.gif",
    },
    {
      nome: "Butterfly Yoga Flaps",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/butterfly-yoga-flaps.gif",
    },
    {
      nome: "Frog Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/frog-crunch.gif",
    },
  ],
  quarta: [
    {
      nome: "Cadeira Extensora",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/cadeira-extensora.gif",
    },
    {
      nome: "Agachamento no Smith",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/agachamento-smith.webp",
    },
    {
      nome: "Leg Press",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/leg-press.gif",
    },
    {
      nome: "Afundo",
      tipo: "musculacao",
      series: "4x12 cada lado",
      gif: "gift/afundo.webp",
    },
    {
      nome: "Adução de quadril",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/audutora.webp",
    },
    {
      nome: "Mesa Flexora",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/mesa-flexora.gif",
    },
    {
      nome: "Elevação de panturrilhas",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/elevacao-panturrilhas-sentado.gif",
    },
    {
      nome: "Flexão de braços",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/flexao-de-bracos.webp",
    },
    {
      nome: "Prancha lateral perna",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/prancha-lateral-com-elevacao-de-perna.webp",
    },
    {
      nome: "Hollow Rock",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/hollow-rock.webp",
    },
    {
      nome: "Toque de caranguejo",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/caranguejo.gif",
    },
    {
      nome: "Alongamento de sapo",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/Alongamento-sapo.gif",
    },
    {
      nome: "Ponte de abdução",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/ponte-com-abducao-de-pernas.webp",
    },
  ],
  quinta: [
    {
      nome: "Remada unilateral",
      tipo: "musculacao",
      series: "4x20",
      gif: "gift/remada-unilateral.webp",
    },
    {
      nome: "Fly inverso",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/fly-inverso.webp",
    },
    {
      nome: "Cruxifixo",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/crucifixo.gif",
    },
    {
      nome: "Supino vertical",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/supino-vertical.gif",
    },
    {
      nome: "Desenvolvimento",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/desenvolvimento.gif",
    },
    {
      nome: "Elevação lateral polia",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/elevacao-lateral-na-polia.gif",
    },
    {
      nome: "Rosca francesa",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/rosca-francesa.gif",
    },
    {
      nome: "Rosca Z Supinada",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/rosca-z-supinada.gif",
    },
    {
      nome: "Prancha com flexão",
      tipo: "abdomen",
      series: "4 x 60s",
      gif: "gift/prancha-com-flexao.webp",
    },
    {
      nome: "Flexão de braços",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/flexao-de-bracos.webp",
    },
    {
      nome: "Abdominal vertical",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-vertical.webp",
    },
    {
      nome: "Polichinelos",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/polichinelos.webp",
    },
    {
      nome: "Chute lateral",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/chute-lateral.gif",
    },
    {
      nome: "Alongamento barco",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/alongamento-barco.gif",
    },
  ],
  sexta: [
    {
      nome: "Agachamento búlgaro",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/bulgaro.webp",
    },
    {
      nome: "Leg Press Horizontal",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/leg-press-horizontal.gif",
    },
    {
      nome: "Cadeira Extensora",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/cadeira-extensora.gif",
    },
    {
      nome: "Levantamento terra",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/Levantamento-terra.webp",
    },
    {
      nome: "Levantamento stiff",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/levantamento-stiff.gif",
    },
    {
      nome: "Mesa Flexora",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/mesa-flexora.gif",
    },
    {
      nome: "Elevação de panturrilhas",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/elevacao-panturrilhas-sentado.gif",
    },
    {
      nome: "Passada andando",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/passada-andando.gif",
    },
    {
      nome: "Abdominal em V",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-em-v.gif",
    },
    {
      nome: "Abdominal vertical",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-invertido-vertical.gif",
    },
    {
      nome: "Burpee",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/burpee.webp",
    },
    {
      nome: "Abdominal reverso",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-reverso.webp",
    },
    {
      nome: "Starfish Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/starfish-crunch.gif",
    },
    {
      nome: "Alongamento abdominal",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/alongamento-abidominal.gif",
    },
  ],
  sabado: [
    {
      nome: "Remada curvada",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/remada-curvada-h.webp",
    },
    {
      nome: "Supino reto",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/supino-reto-h.webp",
    },
    {
      nome: "Extensão de tríceps",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/tripceps.webp",
    },
    {
      nome: "Rosca martelo",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/Rosca-martelo.webp",
    },
    {
      nome: "Desenvolvimento Arnold",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/desenvolvimento-arnold.webp",
    },
    {
      nome: "Agachamento",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/agachamento-h.webp",
    },
    {
      nome: "Afundo",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/afundo.webp",
    },
    {
      nome: "Remada renegada",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/remada-renegada.gif",
    },
    {
      nome: "Panturrilha em pé",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/panturrilha-h.gif",
    },
    {
      nome: "Abdominal Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/crunch_basic.gif",
    },
    {
      nome: "Flexão de braços",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/flexao-de-bracos.webp",
    },
    {
      nome: "Ponte de abdução",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/ponte-com-abducao-de-pernas.webp",
    },
    {
      nome: "Toque de caranguejo",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/caranguejo.gif",
    },
    {
      nome: "Frog Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/frog-crunch.gif",
    },
    {
      nome: "Prancha abdominal",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/prancha.webp",
    },
  ],
};

const gruposMuscularesSemana = {
  segunda: "(Push): Peito, Ombro e Tríceps",
  terca: "(Pull): Costas e Bíceps",
  quarta: "Pernas-Completo",
  quinta: "(Upper): Superiores-completo",
  sexta: "(Lower): Inferiores-completo",
  sabado: "(Full): Total",
};

const dias = [
  "domingo",
  "segunda",
  "terca",
  "quarta",
  "quinta",
  "sexta",
  "sabado",
];

// Funções de Manipulação de DOM
function mostrarDia(dia) {
  const container = document.getElementById("conteudo-dia");
  if (!container)
    return console.error("Elemento '#conteudo-dia' não encontrado");

  console.log(`Mostrando exercícios para ${dia}`);
  const dados = exerciciosSemana[dia] || [];
  const abdomen = dados.filter((ex) => ex.tipo === "abdomen");
  const musculacao = dados.filter((ex) => ex.tipo === "musculacao");

  container.innerHTML = "";

  if (abdomen.length) {
    container.innerHTML += `<h2>Abdômen & Elevação</h2>`;
    abdomen.forEach((ex, index) => {
      const id = `${dia}-abdomen-${index}`;
      container.innerHTML += `
        <div class="exercicio">
          <input type="checkbox" id="${id}" />
          <p><strong>${ex.nome}:</strong> ${ex.series}</p>
          <div class="gif-container">
            <img src="${ex.gif}" alt="${ex.nome}" />
          </div>
        </div>
      `;
    });
  }

  if (musculacao.length) {
    const grupoMuscular = gruposMuscularesSemana[dia] || "";
    container.innerHTML += `<h2>Musculação: ${grupoMuscular}</h2>`;
    musculacao.forEach((ex, index) => {
      const id = `${dia}-musculacao-${index}`;
      container.innerHTML += `
        <div class="exercicio">
          <input type="checkbox" id="${id}" />
          <p><strong>${ex.nome}:</strong> ${ex.series}</p>
          <div class="gif-container">
            <img src="${ex.gif}" alt="${ex.nome}" />
          </div>
        </div>
      `;
    });
  }

  carregarCheckboxes();
  atualizarEstadoExercicios();
  atualizarMenuAtivo(dia);
  atualizarProgressoDia(dia);
}

function atualizarEstadoExercicios() {
  document
    .querySelectorAll(".exercicio input[type='checkbox']")
    .forEach((checkbox) => {
      const container = checkbox.closest(".exercicio");
      container.classList.toggle("checked", checkbox.checked);
    });
}

function atualizarMenuAtivo(dia) {
  document.querySelectorAll(".menu button").forEach((btn) => {
    btn.classList.remove("ativo");
  });
  const btnAtivo = document.querySelector(`.menu button[onclick*="${dia}"]`);
  if (btnAtivo) btnAtivo.classList.add("ativo");
}

// Funções de Progresso
function atualizarProgressoDia(dia) {
  const checkboxes = document.querySelectorAll(
    "#conteudo-dia input[type='checkbox']"
  );
  const marcados = Array.from(checkboxes).filter((cb) => cb.checked).length;
  const total = checkboxes.length;
  const porcentagem = total ? Math.round((marcados / total) * 100) : 0;

  const barra = document.getElementById(`barra-${dia}`);
  if (barra) {
    barra.style.setProperty("--before-width", `${porcentagem}%`);
    const spanPorcentagem = barra.querySelector(".porcentagem");
    if (spanPorcentagem) spanPorcentagem.textContent = `${porcentagem}%`;
  }

  salvarProgressoDia(dia, porcentagem);
  atualizarSemanasEMeses();
}

function salvarProgressoDia(dia, porcentagem) {
  const dataHoje = new Date().toISOString().split("T")[0];
  let historico = JSON.parse(localStorage.getItem("historicoTreino") || "[]");

  historico = historico.filter(
    (registro) => !(registro.data === dataHoje && registro.dia === dia)
  );
  historico.push({ data: dataHoje, dia, porcentagem });
  historico = historico.slice(-150); // Limita a 150 registros
  localStorage.setItem("historicoTreino", JSON.stringify(historico));
}

function atualizarSemanasEMeses() {
  const historico = JSON.parse(localStorage.getItem("historicoTreino") || "[]");
  const hoje = new Date();
  const anoAtual = hoje.getFullYear();

  const semanas = Array.from({ length: 10 }, (_, i) => ({
    inicio: i * 7,
    fim: i * 7 + 6,
    total: 0,
    count: 0,
  }));

  const meses = Array.from({ length: 12 }, (_, i) => ({
    chave: `${anoAtual}-${i}`,
    total: 0,
    count: 0,
    nome: new Date(anoAtual, i)
      .toLocaleString("pt-BR", { month: "long" })
      .replace(/^\w/, (c) => c.toUpperCase()),
  }));

  const registrosPorDia = {};
  historico.forEach(({ data, dia, porcentagem }) => {
    const chave = `${data}-${dia}`;
    if (
      !registrosPorDia[chave] ||
      registrosPorDia[chave].porcentagem < porcentagem
    ) {
      registrosPorDia[chave] = { data, dia, porcentagem };
    }
  });

  Object.values(registrosPorDia).forEach(({ data, porcentagem }) => {
    const dataTreino = new Date(data);
    const diasPassados = Math.floor(
      (hoje - dataTreino) / (1000 * 60 * 60 * 24)
    );

    semanas.forEach((semana) => {
      if (diasPassados >= semana.inicio && diasPassados <= semana.fim) {
        semana.total += porcentagem;
        semana.count++;
      }
    });

    const chaveMes = `${dataTreino.getFullYear()}-${dataTreino.getMonth()}`;
    const mes = meses.find((m) => m.chave === chaveMes);
    if (mes) {
      mes.total += porcentagem;
      mes.count++;
    }
  });

  semanas.forEach((semana, i) => {
    const barra = document.getElementById(`semana-${i + 1}`);
    if (barra) {
      const media =
        semana.count >= 3 ? Math.round(semana.total / semana.count) : 0;
      barra.style.setProperty("--before-width", `${media}%`);
      const span = barra.querySelector(".porcentagem");
      if (span) span.textContent = semana.count >= 3 ? `${media}%` : "0%";
    }
  });

  meses.forEach((mes, i) => {
    const barra = document.getElementById(`mes-${i + 1}`);
    if (barra) {
      const media = mes.count >= 3 ? Math.round(mes.total / mes.count) : 0;
      barra.style.setProperty("--before-width", `${media}%`);
      const spanNome = barra.querySelector(".nome");
      const spanPerc = barra.querySelector(".porcentagem");
      if (spanNome) spanNome.textContent = mes.nome;
      if (spanPerc) spanPerc.textContent = mes.count >= 3 ? `${media}%` : "0%";
    }
  });
}

// Funções de Estado
function salvarCheckboxes() {
  const estado = {};
  document.querySelectorAll("input[type='checkbox']").forEach((checkbox) => {
    estado[checkbox.id] = checkbox.checked;
  });
  localStorage.setItem("checkboxesEstado", JSON.stringify(estado));
}

function carregarCheckboxes() {
  const estado = JSON.parse(localStorage.getItem("checkboxesEstado") || "{}");
  document.querySelectorAll("input[type='checkbox']").forEach((checkbox) => {
    if (estado[checkbox.id] !== undefined) {
      checkbox.checked = estado[checkbox.id];
    }
  });
}

// Funções de Reset
function resetarProgresso(tipo) {
  if (tipo === "dias") {
    dias.slice(1).forEach((dia) => {
      const barra = document.getElementById(`barra-${dia}`);
      if (barra) {
        barra.style.setProperty("--before-width", "0%");
        const span = barra.querySelector(".porcentagem");
        if (span) span.textContent = "0%";
      }
    });
    localStorage.removeItem("historicoTreino");
    localStorage.removeItem("checkboxesEstado");
  } else if (tipo === "semanas") {
    for (let i = 1; i <= 10; i++) {
      const barra = document.getElementById(`semana-${i}`);
      if (barra) {
        barra.style.setProperty("--before-width", "0%");
        const span = barra.querySelector(".porcentagem");
        if (span) span.textContent = "0%";
      }
    }
    localStorage.removeItem("historicoTreino");
  } else if (tipo === "meses") {
    for (let i = 1; i <= 12; i++) {
      const barra = document.getElementById(`mes-${i}`);
      if (barra) {
        barra.style.setProperty("--before-width", "0%");
        const span = barra.querySelector(".porcentagem");
        if (span) span.textContent = "0%";
      }
    }
    localStorage.removeItem("historicoTreino");
  }
  atualizarSemanasEMeses();
}

// Inicialização
function inicializarApp() {
  const hoje = new Date().getDay();
  const diaHoje = dias[hoje] === "domingo" ? "segunda" : dias[hoje];

  // Limpar localStorage obsoleto
  [
    "historicoDias",
    "exercicios-segunda",
    "exercicios-terca",
    "exercicios-quarta",
    "exercicios-quinta",
    "exercicios-sexta",
  ].forEach((key) => {
    localStorage.removeItem(key);
  });

  // Inicializar barras de progresso
  for (let i = 1; i <= 10; i++) {
    const barra = document.getElementById(`semana-${i}`);
    if (barra) {
      barra.style.setProperty("--before-width", "0%");
      const span = barra.querySelector(".porcentagem");
      if (span) span.textContent = "0%";
    }
  }

  for (let i = 1; i <= 12; i++) {
    const barra = document.getElementById(`mes-${i}`);
    if (barra) {
      barra.style.setProperty("--before-width", "0%");
      const spanNome = barra.querySelector(".nome");
      const spanPerc = barra.querySelector(".porcentagem");
      if (spanNome)
        spanNome.textContent = new Date(2025, i - 1)
          .toLocaleString("pt-BR", { month: "long" })
          .replace(/^\w/, (c) => c.toUpperCase());
      if (spanPerc) spanPerc.textContent = "0%";
    }
  }

  // Carregar progresso inicial
  const historico = JSON.parse(localStorage.getItem("historicoTreino") || "[]");
  if (new Set(historico.map((r) => `${r.data}-${r.dia}`)).size >= 3) {
    atualizarSemanasEMeses();
  }

  // Mostrar dia inicial
  mostrarDia(diaHoje);
}

// Eventos
document.addEventListener("DOMContentLoaded", () => {
  console.log("DOM carregado");

  const elements = {
    aside: document.querySelector("aside"),
    btnProgresso: document.getElementById("abrir-progresso"),
    btnConteudo: document.getElementById("abrir-conteudo"),
    conteudoDia: document.getElementById("conteudo-dia"),
    progressoDia: document.getElementById("progresso-dia"),
    progressoSemanal: document.getElementById("progresso-semanal"),
    progressoMensal: document.getElementById("progresso-mensal"),
    botaoVerDiario: document.getElementById("ver-diario"),
    botaoVerSemanal: document.getElementById("ver-semanal"),
    botaoVerMensal: document.getElementById("ver-mensal"),
    botaoModoEscuro: document.getElementById("toggle-dark-mode"),
    btnResetDias: document.getElementById("btn-reset-dias"),
    btnResetSemana: document.getElementById("btn-reset-semana"),
    btnResetMes: document.getElementById("btn-reset-mes"),
  };

  // Validação de elementos
  Object.entries(elements).forEach(([key, el]) => {
    if (!el) console.warn(`Elemento '${key}' não encontrado`);
  });

  // Inicializar aside
  if (elements.aside) {
    elements.aside.classList.add("oculto");
    elements.aside.classList.remove("mostrar");
    console.log("Aside inicializado como oculto");
  }

  // Modo escuro
  if (elements.botaoModoEscuro) {
    elements.botaoModoEscuro.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      console.log("Modo escuro:", document.body.classList.contains("dark"));
    });
  }

  // Alternar aside
  function alternarAside() {
    if (
      !elements.aside ||
      !elements.btnProgresso ||
      !elements.btnConteudo ||
      !elements.conteudoDia
    ) {
      console.error(
        "Elementos necessários não encontrados para alternar aside"
      );
      return;
    }

    console.log(
      "Alternando aside, classes atuais:",
      elements.aside.classList.toString()
    );
    elements.aside.classList.toggle("mostrar");
    elements.aside.classList.toggle("oculto");
    console.log("Novas classes do aside:", elements.aside.classList.toString());

    const isMobile = window.innerWidth <= 768;
    if (isMobile) {
      if (elements.aside.classList.contains("mostrar")) {
        elements.conteudoDia.style.display = "none";
        elements.btnProgresso.style.display = "none";
        elements.btnConteudo.style.display = "block";
        if (elements.progressoDia)
          elements.progressoDia.style.display = "block";
        if (elements.progressoSemanal)
          elements.progressoSemanal.style.display = "none";
        if (elements.progressoMensal)
          elements.progressoMensal.style.display = "none";
        console.log("Mobile: Aside mostrado, conteudo-dia oculto");
      } else {
        elements.conteudoDia.style.display = "grid";
        elements.btnProgresso.style.display = "block";
        elements.btnConteudo.style.display = "none";
        console.log("Mobile: Aside oculto, conteudo-dia mostrado");
      }
    } else {
      elements.conteudoDia.style.display = "grid";
      elements.btnProgresso.style.display = "block";
      elements.btnConteudo.style.display = "none";
      console.log("Desktop: Aside alternado, conteudo-dia mantido visível");

      // Garantir que o dia atual esteja renderizado
      const btnAtivo = document.querySelector(".menu button.ativo");
      if (btnAtivo) {
        const dia = btnAtivo.getAttribute("onclick")?.match(/'([^']+)'/)?.[1];
        if (dia) {
          console.log(`Re-renderizando ${dia} no desktop`);
          mostrarDia(dia);
        } else {
          console.warn("Nenhum dia ativo encontrado");
        }
      } else {
        console.warn("Nenhum botão ativo encontrado no menu");
      }
    }
  }

  if (elements.btnProgresso) {
    elements.btnProgresso.addEventListener("click", (e) => {
      e.preventDefault();
      console.log("Botão progresso clicado");
      alternarAside();
    });
  } else {
    console.error("Botão #abrir-progresso não encontrado");
  }

  if (elements.btnConteudo) {
    elements.btnConteudo.addEventListener("click", (e) => {
      e.preventDefault();
      console.log("Botão conteúdo clicado");
      alternarAside();
    });
  } else {
    console.error("Botão #abrir-conteudo não encontrado");
  }

  // Alternar progresso
  if (elements.botaoVerDiario) {
    elements.botaoVerDiario.addEventListener("click", () => {
      console.log("Ver diário clicado");
      if (elements.progressoDia) elements.progressoDia.style.display = "block";
      if (elements.progressoSemanal)
        elements.progressoSemanal.style.display = "none";
      if (elements.progressoMensal)
        elements.progressoMensal.style.display = "none";
    });
  }

  if (elements.botaoVerSemanal) {
    elements.botaoVerSemanal.addEventListener("click", () => {
      console.log("Ver semanal clicado");
      if (elements.progressoDia) elements.progressoDia.style.display = "none";
      if (elements.progressoSemanal)
        elements.progressoSemanal.style.display = "block";
      if (elements.progressoMensal)
        elements.progressoMensal.style.display = "none";
    });
  }

  if (elements.botaoVerMensal) {
    elements.botaoVerMensal.addEventListener("click", () => {
      console.log("Ver mensal clicado");
      if (elements.progressoDia) elements.progressoDia.style.display = "none";
      if (elements.progressoSemanal)
        elements.progressoSemanal.style.display = "none";
      if (elements.progressoMensal)
        elements.progressoMensal.style.display = "block";
    });
  }

  // Reset
  if (elements.btnResetDias) {
    elements.btnResetDias.addEventListener("click", () => {
      console.log("Reset dias clicado");
      resetarProgresso("dias");
    });
  }

  if (elements.btnResetSemana) {
    elements.btnResetSemana.addEventListener("click", () => {
      console.log("Reset semanas clicado");
      resetarProgresso("semanas");
    });
  }

  if (elements.btnResetMes) {
    elements.btnResetMes.addEventListener("click", () => {
      console.log("Reset meses clicado");
      resetarProgresso("meses");
    });
  }

  // Checkboxes
  document.addEventListener("change", (e) => {
    if (e.target.type === "checkbox") {
      const container = e.target.closest(".exercicio");
      container.classList.toggle("checked", e.target.checked);
      salvarCheckboxes();
      const btnAtivo = document.querySelector(".menu button.ativo");
      if (btnAtivo) {
        const dia = btnAtivo.getAttribute("onclick")?.match(/'([^']+)'/)?.[1];
        if (dia) atualizarProgressoDia(dia);
      }
    }
  });

  inicializarApp();
});
