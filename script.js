const exerciciosSemana = {
  segunda: [
    {
      nome: "Supino inclinado",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/supino_inclinado.gif",
    },
    {
      nome: "Cruxifixo",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/crucifixo.gif",
    },
    {
      nome: "Supino reto",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/supino_reto.gif",
    },
    {
      nome: "CrossOver",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/crossover.webp",
    },
    {
      nome: "Desenvolvimento",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/desenvolvimento-maquina.gif",
    },
    {
      nome: "Elevação frontal polia",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/elevacao-frontal.gif",
    },
    {
      nome: "Tripceps corda",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/tripceps-corda.gif",
    },
    {
      nome: "Mergulho maquina",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/mergulho-maquina.gif",
    },
    {
      nome: "Abdominal Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/crunch_basic.gif",
    },
    {
      nome: "Prancha abdominal",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/prancha.webp",
    },
    {
      nome: "Abdominal invertido",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal_infra_solo.gif",
    },
    {
      nome: "Prancha lateral",
      tipo: "abdomen",
      series: "3x side",
      gif: "gift/prancha-lateral.gif",
    },
    {
      nome: "Elevação pélvica",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/original.webp",
    },
    {
      nome: "Cat cow pose",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/cat-cow.gif",
    },
  ],
  terca: [
    {
      nome: "Puxada aberta",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/puxada-aberta.webp",
    },
    {
      nome: "Puxada Triângulo",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/puxada-triangulo.webp",
    },
    {
      nome: "Remada baixa",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/remada-baixa.gif",
    },
    {
      nome: "Crucifixo invertido",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/crucifixo-invertido.gif",
    },
    {
      nome: "Rosca alternada",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/rosca-alternada-sentado.gif",
    },
    {
      nome: "Rosca direta polia",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/rosca-direta-polia.gif",
    },
    {
      nome: "Rosca martelo",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/Rosca-martelo.webp",
    },
    {
      nome: "Remada curvada",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/Remada-curvada.webp",
    },
    {
      nome: "Elevação das pernas",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/elevacao-pernas.webp",
    },
    {
      nome: "Russian twist",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/russian-twist.webp",
    },
    {
      nome: "Abdominal bicicleta",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-bicicleta.gif",
    },
    {
      nome: "Prancha com toque no ombro",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/Prancha-toque-ombro.gif",
    },
    {
      nome: "Butterfly Yoga Flaps",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/butterfly-yoga-flaps.gif",
    },
    {
      nome: "Frog Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/frog-crunch.gif",
    },
  ],
  quarta: [
    {
      nome: "Cadeira Extensora",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/cadeira-extensora.gif",
    },
    {
      nome: "Agachamento no Smith",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/agachamento-smith.webp",
    },
    {
      nome: "Leg Press",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/leg-press.gif",
    },
    {
      nome: "Afundo",
      tipo: "musculacao",
      series: "4x12 cada lado",
      gif: "gift/afundo.webp",
    },
    {
      nome: "Adução de quadril",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/audutora.webp",
    },
    {
      nome: "Mesa Flexora",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/mesa-flexora.gif",
    },
    {
      nome: "Elevação de panturrilhas",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/elevacao-panturrilhas-sentado.gif",
    },
    {
      nome: "Flexão de braços",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/flexao-de-bracos.webp",
    },
    {
      nome: "Prancha lateral perna",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/prancha-lateral-com-elevacao-de-perna.webp",
    },
    {
      nome: "Hollow Rock",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/hollow-rock.webp",
    },
    {
      nome: "Toque de caranguejo",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/caranguejo.gif",
    },
    {
      nome: "Alongamento de sapo",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/Alongamento-sapo.gif",
    },
    {
      nome: "Ponte de abdução",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/ponte-com-abducao-de-pernas.webp",
    },
  ],
  quinta: [
    {
      nome: "Remada unilateral",
      tipo: "musculacao",
      series: "4x20",
      gif: "gift/remada-unilateral.webp",
    },
    {
      nome: "Fly inverso",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/fly-inverso.webp",
    },
    {
      nome: "Cruxifixo",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/crucifixo.gif",
    },
    {
      nome: "Supino vertical",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/supino-vertical.gif",
    },
    {
      nome: "Desenvolvimento",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/desenvolvimento.gif",
    },
    {
      nome: "Elevação lateral polia",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/elevacao-lateral-na-polia.gif",
    },
    {
      nome: "Rosca francesa",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/rosca-francesa.gif",
    },
    {
      nome: "Rosca Z Supinada",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/rosca-z-supinada.gif",
    },
    {
      nome: "Prancha com flexão",
      tipo: "abdomen",
      series: "4 x 60s",
      gif: "gift/prancha-com-flexao.webp",
    },
    {
      nome: "Flexão de braços",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/flexao-de-bracos.webp",
    },
    {
      nome: "Abdominal vertical",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-vertical.webp",
    },
    {
      nome: "Polichinelos",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/polichinelos.webp",
    },
    {
      nome: "Chute lateral",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/chute-lateral.gif",
    },
    {
      nome: "Alongamento barco",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/alongamento-barco.gif",
    },
  ],
  sexta: [
    {
      nome: "Agachamento búlgaro",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/bulgaro.webp",
    },
    {
      nome: "Leg Press Horizontal",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/leg-press-horizontal.gif",
    },
    {
      nome: "Cadeira Extensora",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/cadeira-extensora.gif",
    },
    {
      nome: "Levantamento terra",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/Levantamento-terra.webp",
    },
    {
      nome: "Levantamento stiff",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/levantamento-stiff.gif",
    },
    {
      nome: "Mesa Flexora",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/mesa-flexora.gif",
    },
    {
      nome: "Elevação de panturrilhas",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/elevacao-panturrilhas-sentado.gif",
    },
    {
      nome: "Passada andando",
      tipo: "musculacao",
      series: "4x12",
      gif: "gift/passada-andando.gif",
    },
    {
      nome: "Abdominal em V",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-em-v.gif",
    },
    {
      nome: "Abdominal vertical",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-invertido-vertical.gif",
    },
    {
      nome: "Burpee",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/burpee.webp",
    },
    {
      nome: "Abdominal reverso",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/abdominal-reverso.webp",
    },
    {
      nome: "Starfish Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/starfish-crunch.gif",
    },
    {
      nome: "Alongamento abdominal",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/alongamento-abidominal.gif",
    },
  ],
  sabado: [
    {
      nome: "Remada curvada",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/remada-curvada-h.webp",
    },
    {
      nome: "Supino reto",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/supino-reto-h.webp",
    },
    {
      nome: "Extensão de tríceps",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/tripceps.webp",
    },
    {
      nome: "Rosca martelo",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/Rosca-martelo.webp",
    },
    {
      nome: "Desenvolvimento Arnold",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/desenvolvimento-arnold.webp",
    },
    {
      nome: "Agachamento",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/agachamento-h.webp",
    },
    {
      nome: "Afundo",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/afundo.webp",
    },
    {
      nome: "Remada renegada",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/remada-renegada.gif",
    },
    {
      nome: "Panturrilha em pé",
      tipo: "musculacao",
      series: "4x15",
      gif: "gift/panturrilha-h.gif",
    },
    {
      nome: "Abdominal Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/crunch_basic.gif",
    },
    {
      nome: "Flexão de braços",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/flexao-de-bracos.webp",
    },
    {
      nome: "Ponte de abdução",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/ponte-com-abducao-de-pernas.webp",
    },
    {
      nome: "Toque de caranguejo",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/caranguejo.gif",
    },
    {
      nome: "Frog Crunch",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/frog-crunch.gif",
    },
    {
      nome: "Prancha abdominal",
      tipo: "abdomen",
      series: "4x20",
      gif: "gift/prancha.webp",
    },
  ],
};

const gruposMuscularesSemana = {
  segunda: "(Push): Peito, Ombro e Tríceps",
  terca: "(Pull): Costas e Bíceps",
  quarta: "Pernas-Completo",
  quinta: "(Upper): Superiores-completo",
  sexta: "(Lower): Inferiores-completo",
  sabado: "(Full): Total",
};

const dias = [
  "domingo",
  "segunda",
  "terca",
  "quarta",
  "quinta",
  "sexta",
  "sabado",
];

// Funções de Manipulação de DOM
function mostrarDia(dia) {
  const container = document.getElementById("conteudo-dia");
  if (!container)
    return console.error("Elemento '#conteudo-dia' não encontrado");

  console.log(`Mostrando exercícios para ${dia}`);
  const dados = exerciciosSemana[dia] || [];
  const abdomen = dados.filter((ex) => ex.tipo === "abdomen");
  const musculacao = dados.filter((ex) => ex.tipo === "musculacao");

  container.innerHTML = "";

  if (abdomen.length) {
    container.innerHTML += `<h2>Abdômen & Elevação</h2>`;
    abdomen.forEach((ex, index) => {
      const id = `${dia}-abdomen-${index}`;
      container.innerHTML += `
        <div class="exercicio">
          <input type="checkbox" id="${id}" />
          <p><strong>${ex.nome}:</strong> ${ex.series}</p>
          <div class="gif-container">
            <img src="${ex.gif}" alt="${ex.nome}" />
          </div>
        </div>
      `;
    });
  }

  if (musculacao.length) {
    const grupoMuscular = gruposMuscularesSemana[dia] || "";
    container.innerHTML += `<h2>Musculação: ${grupoMuscular}</h2>`;
    musculacao.forEach((ex, index) => {
      const id = `${dia}-musculacao-${index}`;
      container.innerHTML += `
        <div class="exercicio">
          <input type="checkbox" id="${id}" />
          <p><strong>${ex.nome}:</strong> ${ex.series}</p>
          <div class="gif-container">
            <img src="${ex.gif}" alt="${ex.nome}" />
          </div>
        </div>
      `;
    });
  }

  carregarCheckboxes();
  atualizarEstadoExercicios();
  atualizarMenuAtivo(dia);
  atualizarProgressoDia(dia);

  // Adicionar eventos aos checkboxes
  document
    .querySelectorAll("#conteudo-dia input[type='checkbox']")
    .forEach((checkbox) => {
      checkbox.addEventListener("change", () => {
        salvarCheckboxes();
        atualizarEstadoExercicios();
        atualizarProgressoDia(dia);
      });
    });
}

function atualizarEstadoExercicios() {
  document
    .querySelectorAll(".exercicio input[type='checkbox']")
    .forEach((checkbox) => {
      const container = checkbox.closest(".exercicio");
      container.classList.toggle("checked", checkbox.checked);
    });
}

function atualizarMenuAtivo(dia) {
  document.querySelectorAll(".menu button").forEach((btn) => {
    btn.classList.remove("ativo");
  });
  const btnAtivo = document.querySelector(
    `.menu button[onclick="mostrarDia('${dia}')"]`
  );
  if (btnAtivo) btnAtivo.classList.add("ativo");
}

// Funções de Progresso
function atualizarProgressoDia(dia) {
  const checkboxes = document.querySelectorAll(
    "#conteudo-dia input[type='checkbox']"
  );
  const marcados = Array.from(checkboxes).filter((cb) => cb.checked).length;
  const total = checkboxes.length;
  const porcentagem = total ? Math.round((marcados / total) * 100) : 0;

  const barra = document.getElementById(`barra-${dia}`);
  if (barra) {
    barra.style.setProperty("--before-width", `${porcentagem}%`);
    const spanPorcentagem = barra.querySelector(".porcentagem");
    if (spanPorcentagem) spanPorcentagem.textContent = `${porcentagem}%`;
  }

  salvarProgressoDia(dia, porcentagem);
  atualizarSemanasEMeses();
}

function salvarProgressoDia(dia, porcentagem) {
  const dataHoje = new Date().toISOString().split("T")[0];
  let historico = JSON.parse(localStorage.getItem("historicoTreino") || "[]");

  historico = historico.filter(
    (registro) => !(registro.data === dataHoje && registro.dia === dia)
  );
  historico.push({ data: dataHoje, dia, porcentagem });
  historico = historico.slice(-150);
  localStorage.setItem("historicoTreino", JSON.stringify(historico));
}

function atualizarSemanasEMeses() {
  const historico = JSON.parse(localStorage.getItem("historicoTreino") || "[]");
  const hoje = new Date();
  const anoAtual = hoje.getFullYear();

  const semanas = Array.from({ length: 10 }, (_, i) => ({
    inicio: i * 7,
    fim: i * 7 + 6,
    total: 0,
    count: 0,
  }));

  const meses = Array.from({ length: 12 }, (_, i) => ({
    chave: `${anoAtual}-${i}`,
    total: 0,
    count: 0,
    nome: new Date(anoAtual, i)
      .toLocaleString("pt-BR", { month: "long" })
      .replace(/^\w/, (c) => c.toUpperCase()),
  }));

  const registrosPorDia = {};
  historico.forEach(({ data, dia, porcentagem }) => {
    const chave = `${data}-${dia}`;
    if (
      !registrosPorDia[chave] ||
      registrosPorDia[chave].porcentagem < porcentagem
    ) {
      registrosPorDia[chave] = { data, dia, porcentagem };
    }
  });

  Object.values(registrosPorDia).forEach(({ data, porcentagem }) => {
    const dataTreino = new Date(data);
    const diasPassados = Math.floor(
      (hoje - dataTreino) / (1000 * 60 * 60 * 24)
    );

    semanas.forEach((semana) => {
      if (diasPassados >= semana.inicio && diasPassados <= semana.fim) {
        semana.total += porcentagem;
        semana.count++;
      }
    });

    const chaveMes = `${dataTreino.getFullYear()}-${dataTreino.getMonth()}`;
    const mes = meses.find((m) => m.chave === chaveMes);
    if (mes) {
      mes.total += porcentagem;
      mes.count++;
    }
  });

  semanas.forEach((semana, i) => {
    const barra = document.getElementById(`semana-${i + 1}`);
    if (barra) {
      const media =
        semana.count >= 3 ? Math.round(semana.total / semana.count) : 0;
      barra.style.setProperty("--before-width", `${media}%`);
      const span = barra.querySelector(".porcentagem");
      if (span) span.textContent = semana.count >= 3 ? `${media}%` : "0%";
    }
  });

  meses.forEach((mes, i) => {
    const barra = document.getElementById(`mes-${i + 1}`);
    if (barra) {
      const media = mes.count >= 3 ? Math.round(mes.total / mes.count) : 0;
      barra.style.setProperty("--before-width", `${media}%`);
      const spanNome = barra.querySelector(".nome");
      const spanPerc = barra.querySelector(".porcentagem");
      if (spanNome) spanNome.textContent = mes.nome;
      if (spanPerc) spanPerc.textContent = mes.count >= 3 ? `${media}%` : "0%";
    }
  });
}

// Funções de Estado
function salvarCheckboxes() {
  const estado = {};
  document.querySelectorAll("input[type='checkbox']").forEach((checkbox) => {
    estado[checkbox.id] = checkbox.checked;
  });
  localStorage.setItem("checkboxesEstado", JSON.stringify(estado));
}

function carregarCheckboxes() {
  const estado = JSON.parse(localStorage.getItem("checkboxesEstado") || "{}");
  document.querySelectorAll("input[type='checkbox']").forEach((checkbox) => {
    if (estado[checkbox.id] !== undefined) {
      checkbox.checked = estado[checkbox.id];
    }
  });
}

// Funções de Modal e Reset
function mostrarModal(tipo, callback) {
  const modal = document.getElementById("modal-confirmacao");
  const modalMensagem = document.getElementById("modal-mensagem");
  const modalSim = document.getElementById("modal-sim");
  const modalNao = document.getElementById("modal-nao");
  const modalCancelar = document.getElementById("modal-cancelar");

  if (!modal || !modalMensagem || !modalSim || !modalNao || !modalCancelar) {
    console.error("Elementos do modal não encontrados");
    return;
  }

  const mensagens = {
    dias: "Deseja reiniciar o seu progresso diário?",
    semanas: "Deseja reiniciar o seu progresso semanal?",
    meses: "Deseja reiniciar o seu progresso mensal?",
  };

  modalMensagem.textContent =
    mensagens[tipo] || "Deseja reiniciar o progresso?";
  modal.classList.remove("oculta");
  modal.classList.add("mostrar");

  // Limpar eventos anteriores
  const modalSimClone = modalSim.cloneNode(true);
  const modalNaoClone = modalNao.cloneNode(true);
  const modalCancelarClone = modalCancelar.cloneNode(true);
  modalSim.parentNode.replaceChild(modalSimClone, modalSim);
  modalNao.parentNode.replaceChild(modalNaoClone, modalNao);
  modalCancelar.parentNode.replaceChild(modalCancelarClone, modalCancelar);

  // Adicionar novos eventos
  modalSimClone.addEventListener("click", () => {
    callback();
    modal.classList.remove("mostrar");
    modal.classList.add("oculta");
  });

  modalNaoClone.addEventListener("click", () => {
    modal.classList.remove("mostrar");
    modal.classList.add("oculta");
  });

  modalCancelarClone.addEventListener("click", () => {
    modal.classList.remove("mostrar");
    modal.classList.add("oculta");
  });
}

function resetarProgresso(tipo) {
  if (tipo === "dias") {
    dias.slice(1).forEach((dia) => {
      const barra = document.getElementById(`barra-${dia}`);
      if (barra) {
        barra.style.setProperty("--before-width", "0%");
        const span = barra.querySelector(".porcentagem");
        if (span) span.textContent = "0%";
      }
    });
    localStorage.removeItem("historicoTreino");
    localStorage.removeItem("checkboxesEstado");
  } else if (tipo === "semanas") {
    for (let i = 1; i <= 10; i++) {
      const barra = document.getElementById(`semana-${i}`);
      if (barra) {
        barra.style.setProperty("--before-width", "0%");
        const span = barra.querySelector(".porcentagem");
        if (span) span.textContent = "0%";
      }
    }
    localStorage.removeItem("historicoTreino");
  } else if (tipo === "meses") {
    for (let i = 1; i <= 12; i++) {
      const barra = document.getElementById(`mes-${i}`);
      if (barra) {
        barra.style.setProperty("--before-width", "0%");
        const span = barra.querySelector(".porcentagem");
        if (span) span.textContent = "0%";
      }
    }
    localStorage.removeItem("historicoTreino");
  }
  atualizarSemanasEMeses();
  const btnAtivo = document.querySelector(".menu button.ativo");
  if (btnAtivo) {
    const dia = btnAtivo.getAttribute("onclick")?.match(/'([^']+)'/)?.[1];
    if (dia) mostrarDia(dia);
  }
}

// Função para Alternar Aside
function alternarAside() {
  const aside = document.getElementById("aside-progresso");
  const conteudo = document.getElementById("conteudo-dia");
  const abrirProgressoBtns = document.querySelectorAll(".abrir-progresso");
  const abrirConteudoBtns = document.querySelectorAll(".abrir-conteudo");

  if (!aside || !conteudo) {
    console.error(
      "Elementos '#aside-progresso' ou '#conteudo-dia' não encontrados"
    );
    return;
  }

  if (aside.classList.contains("oculta")) {
    aside.classList.remove("oculta");
    aside.classList.add("mostrar");
    conteudo.classList.remove("mostrar");
    conteudo.classList.add("oculta");
    abrirProgressoBtns.forEach((btn) => {
      btn.classList.remove("mostrar");
      btn.classList.add("oculta");
    });
    abrirConteudoBtns.forEach((btn) => {
      btn.classList.remove("oculta");
      btn.classList.add("mostrar");
    });
  } else {
    aside.classList.remove("mostrar");
    aside.classList.add("oculta");
    conteudo.classList.remove("oculta");
    conteudo.classList.add("mostrar");
    abrirProgressoBtns.forEach((btn) => {
      btn.classList.remove("oculta");
      btn.classList.add("mostrar");
    });
    abrirConteudoBtns.forEach((btn) => {
      btn.classList.remove("mostrar");
      btn.classList.add("oculta");
    });
  }
}

// Inicialização
function inicializarApp() {
  const hoje = new Date().getDay();
  const diaHoje = dias[hoje] === "domingo" ? "segunda" : dias[hoje];

  // Limpar localStorage obsoleto
  [
    "historicoDias",
    "exercicios-segunda",
    "exercicios-terca",
    "exercicios-quarta",
    "exercicios-quinta",
    "exercicios-sexta",
  ].forEach((key) => {
    localStorage.removeItem(key);
  });

  // Inicializar barras de progresso
  for (let i = 1; i <= 10; i++) {
    const barra = document.getElementById(`semana-${i}`);
    if (barra) {
      barra.style.setProperty("--before-width", "0%");
      const span = barra.querySelector(".porcentagem");
      if (span) span.textContent = "0%";
    }
  }

  for (let i = 1; i <= 12; i++) {
    const barra = document.getElementById(`mes-${i}`);
    if (barra) {
      barra.style.setProperty("--before-width", "0%");
      const spanNome = barra.querySelector(".nome");
      const spanPerc = barra.querySelector(".porcentagem");
      if (spanNome)
        spanNome.textContent = new Date(2025, i - 1)
          .toLocaleString("pt-BR", { month: "long" })
          .replace(/^\w/, (c) => c.toUpperCase());
      if (spanPerc) spanPerc.textContent = "0%";
    }
  }

  // Carregar progresso inicial
  const historico = JSON.parse(localStorage.getItem("historicoTreino") || "[]");
  if (new Set(historico.map((r) => `${r.data}-${r.dia}`)).size >= 3) {
    atualizarSemanasEMeses();
  }

  // Mostrar dia inicial
  mostrarDia(diaHoje);
}

// Eventos
document.addEventListener("DOMContentLoaded", () => {
  console.log("DOM carregado");

  // Inicializar botões de alternância de aside
  document
    .querySelectorAll(".abrir-progresso, .abrir-conteudo")
    .forEach((btn) => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        console.log(
          `Botão ${
            btn.classList.contains("abrir-progresso") ? "progresso" : "conteúdo"
          } clicado`
        );
        alternarAside();
      });
    });

  // Inicializar botões de modo escuro
  document.querySelectorAll(".toggle-dark-mode").forEach((btn) => {
    btn.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      console.log("Modo escuro:", isDark);
    });
  });

  // Alternar visualização de progresso
  const progressoDia = document.getElementById("progresso-dia");
  const progressoSemanal = document.getElementById("progresso-semanal");
  const progressoMensal = document.getElementById("progresso-mensal");

  const alternarProgressoButtons = [
    { id: "ver-diario", mobileId: "ver-diario-mobile", view: "dia" },
    { id: "ver-semanal", mobileId: "ver-semanal-mobile", view: "semanal" },
    { id: "ver-mensal", mobileId: "ver-mensal-mobile", view: "mensal" },
  ];

  alternarProgressoButtons.forEach(({ id, mobileId, view }) => {
    const buttons = [
      document.getElementById(id),
      document.getElementById(mobileId),
    ].filter(Boolean);
    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        console.log(`Ver ${view} clicado`);
        if (progressoDia)
          progressoDia.style.display = view === "dia" ? "block" : "none";
        if (progressoSemanal)
          progressoSemanal.style.display =
            view === "semanal" ? "block" : "none";
        if (progressoMensal)
          progressoMensal.style.display = view === "mensal" ? "block" : "none";
        buttons.forEach((b) => b.classList.add("active"));
        alternarProgressoButtons
          .filter((other) => other.view !== view)
          .forEach(({ id, mobileId }) => {
            [document.getElementById(id), document.getElementById(mobileId)]
              .filter(Boolean)
              .forEach((b) => b.classList.remove("active"));
          });
      });
    });
  });

  // Reset de progresso com modal
  const resetButtons = [
    { id: "btn-reset-dias", mobileId: "btn-reset-dias-mobile", tipo: "dias" },
    {
      id: "btn-reset-semana",
      mobileId: "btn-reset-semana-mobile",
      tipo: "semanas",
    },
    { id: "btn-reset-mes", mobileId: "btn-reset-mes-mobile", tipo: "meses" },
  ];

  resetButtons.forEach(({ id, mobileId, tipo }) => {
    const buttons = [
      document.getElementById(id),
      document.getElementById(mobileId),
    ].filter(Boolean);
    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        console.log(`Botão reset ${tipo} clicado`);
        // Determinar a seção ativa
        let secaoAtiva = "dias";
        if (progressoSemanal.style.display === "block") {
          secaoAtiva = "semanas";
        } else if (progressoMensal.style.display === "block") {
          secaoAtiva = "meses";
        }
        mostrarModal(secaoAtiva, () => resetarProgresso(tipo));
      });
    });
  });

  // Definir visualização padrão
  const btnSemanal = document.getElementById("ver-semanal");
  if (btnSemanal) {
    btnSemanal.click(); // Simula clique para abrir progresso semanal
  }

  inicializarApp();
});
